# RBAC

以角色為基礎的存取控制（Role-Based Access Control，RBAC) 是一種透過「角色」橋接使用者與權限的授權模型。

本專案以:

* 三層級架構：明確區分平台（PLATFORM）、餐廳（RESTAURANT）、分店（BRANCH）三個作用域，符合餐飲連鎖業的組織需求
* 權限顆粒化：透過 permission_code 與功能選單綁定，同時支援頁面（PAGE）與按鈕（BUTTON）級控制
* 多租戶隔離：餐廳與分店ID貫穿所有資料表，天然支持集團式多店管理

同時結合 Spring Security 綁定 API 與使用權限, 功能選單表（function_menu）透過 permission_code 關聯前端路由，實現「權限即菜單」的直觀設計。


## UML

```mermaid
classDiagram

class 使用者 {
  +id: BIGINT (主鍵)
  +user_account: VARCHAR(100) (唯一帳號)
  +username: VARCHAR(100) (顯示名稱)
  +passwd: VARCHAR(255) (加密密碼)
  +employee_no: VARCHAR(50) (員工編號)
  +restaurant_id: BIGINT (餐廳ID)
  +branch_id: BIGINT (分店ID)
  +account_scope: VARCHAR(20) (帳號層級)
  +is_active: TINYINT (啟用狀態)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

class 角色 {
  +id: BIGINT (主鍵)
  +code: VARCHAR(50) (角色代碼)
  +name: VARCHAR(50) (角色名稱)
  +description: VARCHAR(255) (角色描述)
  +scope: VARCHAR(20) (作用範圍)
  +is_default: TINYINT (預設角色)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

class 權限 {
  +id: BIGINT (主鍵)
  +code: VARCHAR(100) (權限代碼)
  +name: VARCHAR(100) (權限名稱)
  +scope: VARCHAR(20) (作用範圍)
  +description: VARCHAR(255) (權限描述)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

class 功能選單 {
  +id: BIGINT (主鍵)
  +parent_id: BIGINT (父層ID)
  +name: VARCHAR(100) (功能名稱)
  +route_path: VARCHAR(200) (路由路徑)
  +component: VARCHAR(200) (組件路徑)
  +permission_code: VARCHAR(100) (關聯權限)
  +sort_order: INT (排序編號)
  +type: VARCHAR(20) (功能類型)
  +visible_scope: VARCHAR(20) (可見範圍)
  +is_active: TINYINT (啟用狀態)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

class 使用者角色關聯 {
  +id: BIGINT (主鍵)
  +user_id: BIGINT (使用者ID)
  +role_id: BIGINT (角色ID)
  +created_at: DATETIME (建立時間)
}

class 角色權限關聯 {
  +id: BIGINT (主鍵)
  +role_id: BIGINT (角色ID)
  +permission_id: BIGINT (權限ID)
  +created_at: DATETIME (建立時間)
}

class 餐廳 {
  +id: BIGINT (主鍵)
  +name: VARCHAR(100) (餐廳名稱)
  +code: VARCHAR(50) (餐廳代碼)
  +industry_type: VARCHAR(50) (業態類型)
  +region_code: VARCHAR(10) (區域代碼)
  +timezone: VARCHAR(50) (時區)
  +currency_code: VARCHAR(10) (幣別)
  +status: TINYINT (狀態)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

class 分店 {
  +id: BIGINT (主鍵)
  +restaurant_id: BIGINT (餐廳ID)
  +name: VARCHAR(100) (分店名稱)
  +branch_code: VARCHAR(30) (分店代碼)
  +address: VARCHAR(255) (地址)
  +phone: VARCHAR(30) (電話)
  +region_code: VARCHAR(10) (區域代碼)
  +timezone: VARCHAR(50) (時區)
  +tax_id: VARCHAR(20) (統一編號)
  +manager_name: VARCHAR(100) (負責人)
  +note: TEXT (備註)
  +status: TINYINT (狀態)
  +created_at: DATETIME (建立時間)
  +updated_at: DATETIME (更新時間)
}

使用者 "1" -- "*" 使用者角色關聯 : "擁有"
角色 "1" -- "*" 使用者角色關聯 : "被分配"
角色 "1" -- "*" 角色權限關聯 : "包含"
權限 "1" -- "*" 角色權限關聯 : "被授予"
功能選單 "1" -- "0..1" 權限 : "通過權限代碼關聯"
功能選單 "0..1" -- "*" 功能選單 : "父子層級關係"
餐廳 "1" -- "*" 分店 : "擁有"
餐廳 "1" -- "*" 使用者 : "擁有餐廳管理員帳號\n(account_scope=RESTAURANT)"
分店 "1" -- "*" 使用者 : "擁有多個分店帳號\n(account_scope=BRANCH)"

note for 使用者 "帳號層級說明：
• PLATFORM：平台管理員
• RESTAURANT：餐廳管理員
• BRANCH：分店管理員"
note for 角色 "角色作用範圍需匹配:
• RESTAURANT級角色 → 餐廳管理員
• BRANCH級角色 → 分店管理員"
```